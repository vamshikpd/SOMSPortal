package gov.ca.cdcr.somsportal;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpServletRequest;
import java.util.*;

class SOMSPortalUtils {

    private static final Logger log = LogManager.getLogger();
    private static final String PROP_FILE = "/WEB-INF/resources/somsportal.properties";

    static List<SOMSApplication> getEntitledAppsList(HttpServletRequest request, ServletContext context) {

        String groups = getGroupsFromHeaders(request);
        if (groups == null) {
            log.warn("'Groups' HTTP Header was not provided.");
        }

        SOMSApplicationHandler applicationHandler = new SOMSApplicationHandler(context, PROP_FILE);

        List<SOMSApplication> entitledApps = new LinkedList<>(); // initialize with empty list
        try {
            entitledApps = applicationHandler.getEntitledApps(groups);
        } catch (Exception e) {
            log.error("Error while processing the list of entitled SOMS apps", e);
        }

        return entitledApps;

    }

    private static String getGroupsFromHeaders(HttpServletRequest request) {
        String groups = "";
        Enumeration enumeration = request.getHeaderNames();
        while (enumeration.hasMoreElements()) {
            String name = (String) enumeration.nextElement();
            String value = request.getHeader(name);
            if (name.equalsIgnoreCase("GROUPS")) {
                groups = value;
            }
        }

        //if (groups.equals("")) {
        // ==================================================================================================
        // IF the groups are blank -- use the TEST GROUPS below -- TEMPORARY
        // ==================================================================================================
//            groups="CN=App-CDCR-SOMSeOMIS-RptAdmin,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-RADtool7,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-RADtool6,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-RADtool4,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-SysAdmin,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-DataAdm,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-FulView5,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-LtdView5,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov";
//            groups="CN=App-CDCR-SOMSERMS-eScan-OperatorsZZZZZ,OU=ERMS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-RptAdmin,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=zzz,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-RADtool7,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-RADtool6,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-RADtool4,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-SysAdmin,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-DataAdm,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-FulView5,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-LtdView5,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov";
        //groups="CN=App-CDCR-SOMSERMS-eScan-OperatorsZZZZZ,OU=ERMS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-RptAdmin,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=zzz,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-RADtool7,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSERMS-ecf-all-lvl1,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSERMS-eScan-Operators,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-SysAdmin,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-DataAdm,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-FulView5,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-LtdView5,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov";
        //groups="CN=App-CDCR-SOMSCaptiva-ScannersZZZZZ,OU=ERMS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-RptAdmin,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=zzz,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-RADtool7,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSERMS-ecf-all-lvl1,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSERMS-eScan-Operators,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-SysAdmin,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-DataAdm,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-FulView5,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSeOMIS-LtdView5,OU=Groups,OU=eOMIS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov";
        //groups = "CN=App-CDCR-SOMSLEADS-xxxxx-OperatorsZZZZZ,OU=ERMS,OU=SOMS,DC=soms,DC=temp,DC=ca,DC=gov:CN=App-CDCR-SOMSOpAdHoc-BIPUBADM,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAInstMgmt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CATigerTeam,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACorrLt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACorrOff,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMS-Tng-ecf-std-lvl4,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSERMS-ecf-std-lvl1,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSOpAdHoc-OAHC,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAAdmin,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAnotDS,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAAdaCo,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCRunReports,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCLocSysAdm,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCSuperUser,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCLocLoad,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSClinAnal,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSRunRpts,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSRcvRel,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSClEncEnt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSSchedulers,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSReqEnt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSCareCpt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSCorrSgt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAInmSupv,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHelpDesk,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACaseRcdsTech,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACaseRcdsSupv,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACaseRcdsAnl,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAEduc,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CASupv,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACorrCounsSpec,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACorrCouns,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACentCtrlSgt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACentCtrlOff,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAISUERO,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAInmAsgOAOT,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAInmAsgCustSupv,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CARRStaff,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAnoSD,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CARRSgt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CATranSgt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACorrSgt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAVisitSupv,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAALL,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSEIDM-OIM-AL3,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAAdaAdmin,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSBI-BIHC,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSBI-BIPU,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSBI-SBIADM,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CASchAdmin,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCStateAdmin,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCSecAdmin,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCSolCtr,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAMHPsychologists,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAMHPsychiatrists,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAMHPhySpvMH,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CADNPhySpvDn,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAMDPhySpvMd,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAMDTTA,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSSearch,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSMedRcds,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSRCA,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSRecCtr,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSCMO,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSCSW,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSCorrLt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAExtSOMSUsers,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CASysAdm,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CASecAdm,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAPopMgmtHQ,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAExcProcTeam,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAParole,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CABPH,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAISUOAOT,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CATranCO,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAVisitOff,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CADAI,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CASpecAsgn,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAWardenOffice,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAPubInfOff,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAFacCust,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=govCAPgmSuppUnitHQ,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-";
        //groups = "CN=App-CDCR-SOMSOpAdHoc-BIPUBADM,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAInstMgmt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CATigerTeam,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACorrLt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACorrOff,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMS-Tng-ecf-std-lvl4,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSERMS-ecf-std-lvl1,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSOpAdHoc-OAHC,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAAdmin,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAnotDS,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAAdaCo,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCRunReports,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCLocSysAdm,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCSuperUser,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCLocLoad,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSClinAnal,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSRunRpts,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSRcvRel,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSClEncEnt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSSchedulers,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSReqEnt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSCareCpt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSCorrSgt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAInmSupv,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHelpDesk,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACaseRcdsTech,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACaseRcdsSupv,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACaseRcdsAnl,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAEduc,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CASupv,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACorrCounsSpec,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACorrCouns,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACentCtrlSgt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACentCtrlOff,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAISUERO,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAInmAsgOAOT,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAInmAsgCustSupv,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CARRStaff,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAnoSD,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CARRSgt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CATranSgt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CACorrSgt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAVisitSupv,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAALL,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSEIDM-OIM-AL3,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAAdaAdmin,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSBI-BIHC,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSBI-BIPU,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSBI-SBIADM,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CASchAdmin,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCStateAdmin,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCSecAdmin,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHCSolCtr,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAMHPsychologists,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAMHPsychiatrists,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAMHPhySpvMH,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CADNPhySpvDn,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAMDPhySpvMd,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAMDTTA,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSSearch,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSMedRcds,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSRCA,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSRecCtr,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSCMO,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSCSW,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAHSCorrLt,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAExtSOMSUsers,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CASysAdm,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CASecAdm,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAPopMgmtHQ,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAExcProcTeam,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAParole,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CABPH,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAISUOAOT,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CATranCO,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAVisitOff,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CADAI,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CASpecAsgn,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAWardenOffice,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAPubInfOff,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-CAFacCust,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=govCAPgmSuppUnitHQ,OU=SOMS,OU=Apps,OU=CDCR,dc=ad,dc=oid,dc=soms,dc=ca,dc=gov:CN=App-CDCR-SOMSeOMIS-";
        //}
        return groups;
    }

    static String extractAppSpecificGroups(String groupslist, List<String> appGroups) {

        Set<String> matchedGroupSet = new LinkedHashSet<String>();
        StringBuilder extractedAppGroups = new StringBuilder();
        StringTokenizer tokens = new StringTokenizer(groupslist,"|");

        while(tokens.hasMoreTokens()) {
            String token = tokens.nextToken().trim();


            // if this is a CN element
            if (token.indexOf("CN",0) > -1 ) {

//                System.out.println("Processing token: " + token);
                for (String appGroup : appGroups) {
                    if (token.contains(appGroup)) {
//                        System.out.println("Match app group: " + token);
                        matchedGroupSet.add(token);
                    }
                }
            }
        }

        String delim = "";
        for(String hcaGroup : matchedGroupSet) {
            extractedAppGroups.append(delim);
            delim = ":";
            extractedAppGroups.append(hcaGroup);
        }

        return extractedAppGroups.toString();

    }

}
